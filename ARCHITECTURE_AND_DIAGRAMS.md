# ğŸ“ Tekton Website - Architecture & Diagrams

## Entity Relationship Diagram (ERD)

### MongoDB Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE SCHEMA                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      USERS           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id (ObjectId)       â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fullname (String)    â”‚                             â”‚
â”‚ email (String)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ password (String)    â”‚          â”‚                  â”‚
â”‚ role (String)        â”‚          â”‚                  â”‚
â”‚ isEnabled (Boolean)  â”‚          â”‚                  â”‚
â”‚ lastLoginAt (Date)   â”‚          â”‚                  â”‚
â”‚ createdAt (Date)     â”‚          â”‚                  â”‚
â”‚ updatedAt (Date)     â”‚          â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                  â”‚
         â”‚                        â”‚                  â”‚
         â”‚ 1:N                    â”‚                  â”‚
         â”‚                        â”‚                  â”‚
         â–¼                        â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚      MARKERS                 â”‚  â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                  â”‚
â”‚ _id (ObjectId)               â”‚  â”‚                  â”‚
â”‚ filename (String)            â”‚  â”‚                  â”‚
â”‚ filepath (String)            â”‚  â”‚                  â”‚
â”‚ filesize (Number)            â”‚  â”‚                  â”‚
â”‚ uploadedBy (String)          â”‚â”€â”€â”˜ (user email)    â”‚
â”‚ uploadedAt (Date)            â”‚                     â”‚
â”‚ metadata {                   â”‚                     â”‚
â”‚   hash (String)              â”‚                     â”‚
â”‚   checksumValidated (Bool)   â”‚                     â”‚
â”‚ }                            â”‚                     â”‚
â”‚ createdAt (Date)             â”‚                     â”‚
â”‚ updatedAt (Date)             â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚      EVENTS                  â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚ _id (ObjectId)               â”‚                     â”‚
â”‚ title (String)               â”‚                     â”‚
â”‚ description (String)         â”‚                     â”‚
â”‚ location (String)            â”‚                     â”‚
â”‚ latitude (Number)            â”‚                     â”‚
â”‚ longitude (Number)           â”‚                     â”‚
â”‚ createdBy (String)           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (user email)
â”‚ markers [ObjectId]           â”‚â”€â” (references Markers)
â”‚ createdAt (Date)             â”‚ â”‚
â”‚ updatedAt (Date)             â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â–²                        â”‚
         â”‚ 1:N                    â”‚
         â”‚                        â”‚
         â”‚ N:M (Many Events       â”‚
         â”‚     Many Markers)      â”‚
         â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ACTIVITY_LOGS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id (ObjectId)                   â”‚
â”‚ username (String)                â”‚
â”‚ email (String)                   â”‚
â”‚ action (String)                  â”‚
â”‚ role (String)                    â”‚
â”‚ ipAddress (String)               â”‚
â”‚ details (String)                 â”‚
â”‚ userId (ObjectId)                â”‚â”€â”€â–º (ref to Users, can be null)
â”‚ createdAt (Date)                 â”‚
â”‚ updatedAt (Date)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Relationships Explained

**1. Users â†’ Markers (1:N)**
- One user can upload many markers
- Each marker has uploadedBy (email reference)
- Soft reference (email, not ObjectId)

**2. Users â†’ ActivityLogs (1:N)**
- One user can have many activity log entries
- Each log records what the user did
- userId can be null (for sign-out events)

**3. Users â†’ Events (1:N)**
- One user can create many events
- Events have createdBy (email reference)
- User can manage their own events

**4. Events â†” Markers (N:M)**
- One event can have many markers
- One marker can be in many events
- Managed through markers array in Events

---

## Data Flow Diagram (DFD)

### Level 0: System Context

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   TEKTON WEBSITE    â”‚
                        â”‚   (Main System)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   USERS      â”‚          â”‚   MONGODB    â”‚
            â”‚              â”‚          â”‚   DATABASE   â”‚
            â”‚ â”œâ”€ Login     â”‚          â”‚              â”‚
            â”‚ â”œâ”€ Register  â”‚          â”‚ â”œâ”€ Users     â”‚
            â”‚ â”œâ”€ Browse    â”‚          â”‚ â”œâ”€ Markers   â”‚
            â”‚ â”œâ”€ Upload    â”‚          â”‚ â”œâ”€ Events    â”‚
            â”‚ â”œâ”€ Download  â”‚          â”‚ â”œâ”€ Logs      â”‚
            â”‚ â””â”€ Logout    â”‚          â”‚ â””â”€ Metadata  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â–²
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (Data Requests/Responses)
```

### Level 1: Main Processes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER AUTHENTICATION                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Signup Process                                           â”‚
â”‚     â”œâ”€ Validate input (email, password, name)               â”‚
â”‚     â”œâ”€ Sanitize input (remove XSS)                          â”‚
â”‚     â”œâ”€ Check duplicate email                                â”‚
â”‚     â”œâ”€ Hash password (bcrypt)                               â”‚
â”‚     â”œâ”€ Store user in database                               â”‚
â”‚     â””â”€ Generate JWT token                                   â”‚
â”‚                                                              â”‚
â”‚  2. Login Process                                            â”‚
â”‚     â”œâ”€ Validate input                                       â”‚
â”‚     â”œâ”€ Find user by email                                   â”‚
â”‚     â”œâ”€ Verify password (bcrypt compare)                     â”‚
â”‚     â”œâ”€ Check account enabled status                         â”‚
â”‚     â”œâ”€ Log login activity                                   â”‚
â”‚     â”œâ”€ Generate JWT token                                   â”‚
â”‚     â””â”€ Return token to client                               â”‚
â”‚                                                              â”‚
â”‚  3. Logout Process (NEW)                                    â”‚
â”‚     â”œâ”€ Verify JWT token                                     â”‚
â”‚     â”œâ”€ Extract user info from token                         â”‚
â”‚     â”œâ”€ Get IP address from request                          â”‚
â”‚     â”œâ”€ Create sign-out event log                            â”‚
â”‚     â”œâ”€ Save to ActivityLogs collection                      â”‚
â”‚     â””â”€ Return success response                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FILE MANAGEMENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Upload Marker                                            â”‚
â”‚     â”œâ”€ Verify authentication (JWT)                          â”‚
â”‚     â”œâ”€ Validate file (size, type)                           â”‚
â”‚     â”œâ”€ Generate file hash (SHA-256)                         â”‚
â”‚     â”œâ”€ Save file to disk                                    â”‚
â”‚     â”œâ”€ Create Marker record in DB                           â”‚
â”‚     â”œâ”€ Log upload activity                                  â”‚
â”‚     â””â”€ Return marker info                                   â”‚
â”‚                                                              â”‚
â”‚  5. Download Marker                                          â”‚
â”‚     â”œâ”€ Verify authentication (JWT)                          â”‚
â”‚     â”œâ”€ Find marker by ID                                    â”‚
â”‚     â”œâ”€ Verify integrity (recalculate hash)                  â”‚
â”‚     â”œâ”€ Log download activity                                â”‚
â”‚     â”œâ”€ Send file to user                                    â”‚
â”‚     â””â”€ Return file data                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ADMIN OPERATIONS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. User Management                                          â”‚
â”‚     â”œâ”€ Verify admin role                                    â”‚
â”‚     â”œâ”€ Get all users                                        â”‚
â”‚     â”œâ”€ Edit user info                                       â”‚
â”‚     â”œâ”€ Toggle user status (enable/disable)                  â”‚
â”‚     â”œâ”€ Delete user                                          â”‚
â”‚     â””â”€ Log all admin actions                                â”‚
â”‚                                                              â”‚
â”‚  7. Activity Log Viewing                                     â”‚
â”‚     â”œâ”€ Verify admin role                                    â”‚
â”‚     â”œâ”€ Query ActivityLogs collection                        â”‚
â”‚     â”œâ”€ Apply filters (action, date range)                   â”‚
â”‚     â”œâ”€ Apply search (username, email)                       â”‚
â”‚     â”œâ”€ Apply pagination                                     â”‚
â”‚     â”œâ”€ Sort by date (descending)                            â”‚
â”‚     â””â”€ Return filtered logs                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Level 2: Detailed Process - Login Flow

```
START: User Submits Login Form
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND VALIDATION              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ Email format valid?           â”‚
â”‚ â”œâ”€ Password not empty?           â”‚
â”‚ â””â”€ Return 400 if invalid         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEND HTTPS REQUEST TO /api/login â”‚
â”‚ POST {email, password}           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND VALIDATION               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ CORS check                    â”‚
â”‚ â”œâ”€ Express-validator check       â”‚
â”‚ â”œâ”€ Email/password format         â”‚
â”‚ â””â”€ Return 400 if invalid         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE QUERY                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User.findOne({email})            â”‚
â”‚ Result: User object or null      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚
        NO         YES
        â”‚          â”‚
        â–¼          â–¼
    Return    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    400       â”‚ VERIFY PASSWORD      â”‚
    "User     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    not       â”‚ bcrypt.compare()     â”‚
    found"    â”‚ Match? Yes/No        â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                 â”‚          â”‚
                 NO         YES
                 â”‚          â”‚
                 â–¼          â–¼
             Return    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             400       â”‚ CHECK ENABLED STATUS â”‚
             "Invalid  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             password" â”‚ user.isEnabled       â”‚
                       â”‚ True/False           â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                           â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                           â”‚          â”‚
                          FALSE       TRUE
                           â”‚          â”‚
                           â–¼          â–¼
                       Return     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       403        â”‚ UPDATE LAST LOGIN    â”‚
                       "Account   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       deactivated"user.lastLoginAt =    â”‚
                                  â”‚ Date.now()           â”‚
                                  â”‚ Save to DB           â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ LOG ACTIVITY         â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ Create ActivityLog:  â”‚
                                  â”‚ - username           â”‚
                                  â”‚ - email              â”‚
                                  â”‚ - action: "Login"    â”‚
                                  â”‚ - ipAddress          â”‚
                                  â”‚ - details            â”‚
                                  â”‚ Save to DB           â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ GENERATE JWT         â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ jwt.sign({           â”‚
                                  â”‚   userId: user._id,  â”‚
                                  â”‚   role: user.role    â”‚
                                  â”‚ })                   â”‚
                                  â”‚ Expires: 24h         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ SEND RESPONSE        â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ Status: 200          â”‚
                                  â”‚ {                    â”‚
                                  â”‚   token: "jwt...",   â”‚
                                  â”‚   fullname: "John",  â”‚
                                  â”‚   role: "researcher" â”‚
                                  â”‚ }                    â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ FRONTEND RECEIVES    â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ Store in localStorageâ”‚
                                  â”‚ - token              â”‚
                                  â”‚ - fullname           â”‚
                                  â”‚ - email              â”‚
                                  â”‚ Navigate to /dashboard
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  END: User logged in successfully
```

### Level 2: Detailed Process - Logout Flow (NEW)

```
START: User Clicks "Sign Out"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND ACTION                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Get token from localStorage      â”‚
â”‚ Call: POST /api/logout           â”‚
â”‚ Header: Authorization: Bearer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: AUTH MIDDLEWARE         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ Get token from header         â”‚
â”‚ â”œâ”€ Verify signature              â”‚
â”‚ â”œâ”€ Check expiration              â”‚
â”‚ â””â”€ Extract user data             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚
      VALID     INVALID
        â”‚          â”‚
        â–¼          â–¼
    Continue   Return 401
               "Unauthorized"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXTRACT USER INFO                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ From JWT token:                  â”‚
â”‚ - userId                         â”‚
â”‚ - role                           â”‚
â”‚ Query database for:              â”‚
â”‚ - fullname                       â”‚
â”‚ - email                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET IP ADDRESS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ req.ip or                        â”‚
â”‚ req.connection.remoteAddress     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREATE ACTIVITY LOG              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ActivityLog.create({             â”‚
â”‚   username: "John Doe",          â”‚
â”‚   email: "john@example.com",     â”‚
â”‚   action: "Sign Out",            â”‚
â”‚   role: "admin",                 â”‚
â”‚   ipAddress: "192.168.1.100",    â”‚
â”‚   details: "Signed out from...", â”‚
â”‚   userId: null,                  â”‚
â”‚   createdAt: Date.now()          â”‚
â”‚ })                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚
      SUCCESS    FAIL
        â”‚          â”‚
        â–¼          â–¼
    Continue   Log error
               (Continue anyway)
        â”‚          â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEND RESPONSE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: 200                      â”‚
â”‚ {                                â”‚
â”‚   success: true,                 â”‚
â”‚   message: "Logged out           â”‚
â”‚   successfully"                  â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND RECEIVES RESPONSE       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (Logout continues even if API    â”‚
â”‚  call fails - graceful degradation)
â”‚ Clear localStorage:              â”‚
â”‚ - token                          â”‚
â”‚ - fullname                       â”‚
â”‚ - email                          â”‚
â”‚ - userId                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SHOW SUCCESS NOTIFICATION        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Display: "Logged out             â”‚
â”‚ successfully"                    â”‚
â”‚ Auto-hide after 3 seconds        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NAVIGATE TO LOGIN                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ navigate("/login")               â”‚
â”‚ User sees login form             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VERIFY SIGN-OUT EVENT LOGGED     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Admin can view in Event Log:     â”‚
â”‚ â”œâ”€ Username: John Doe           â”‚
â”‚ â”œâ”€ Email: john@example.com      â”‚
â”‚ â”œâ”€ Action: Sign Out             â”‚
â”‚ â”œâ”€ Role: admin                  â”‚
â”‚ â”œâ”€ IP: 192.168.1.100            â”‚
â”‚ â””â”€ Timestamp: 2024-01-15 10:30  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
        END: User signed out
        Event logged to MongoDB
```

---

## System Integration Points

### API Endpoints Map

```
Authentication Endpoints:
â”œâ”€â”€ POST /api/signup              â†’ User registration
â”œâ”€â”€ POST /api/login               â†’ User login
â””â”€â”€ POST /api/logout              â†’ User logout (NEW)

User Routes:
â”œâ”€â”€ GET /api/admin/users          â†’ List all users (admin only)
â”œâ”€â”€ PUT /api/admin/users/:id      â†’ Update user (admin only)
â”œâ”€â”€ PUT /api/admin/users/:id/role â†’ Update role (admin only)
â””â”€â”€ DELETE /api/admin/users/:id   â†’ Delete user (admin only)

Marker Routes:
â”œâ”€â”€ POST /api/markers/upload      â†’ Upload file
â”œâ”€â”€ GET /api/markers/download/:id â†’ Download file
â””â”€â”€ GET /api/markers/stats        â†’ Get statistics

Event Routes:
â”œâ”€â”€ GET /api/events               â†’ List events
â”œâ”€â”€ POST /api/events              â†’ Create event
â””â”€â”€ PUT /api/events/:id           â†’ Update event

Activity Log Routes:
â”œâ”€â”€ POST /api/activity-log        â†’ Log activity
â””â”€â”€ GET /api/activity-log         â†’ Get logs (admin only, paginated)
```

### Data Flow: Request to Response

```
Client Request:
  â†“ [HTTPS/TLS Encrypted]
Frontend Layer:
  â”œâ”€ Validation
  â”œâ”€ Sanitization
  â””â”€ API Call (axios)
  â†“ [HTTPS/TLS Encrypted]
Backend Middleware:
  â”œâ”€ CORS Check
  â”œâ”€ Body Parser
  â”œâ”€ Auth Verification (JWT)
  â”œâ”€ Input Validation
  â””â”€ Request Logging
  â†“
Route Handler:
  â”œâ”€ Extract Data
  â”œâ”€ Additional Checks
  â””â”€ Business Logic
  â†“
Database Layer:
  â”œâ”€ Query/Mutation
  â”œâ”€ Data Integrity Check
  â””â”€ Return Results
  â†“
Backend Response:
  â”œâ”€ Format Data
  â”œâ”€ Log Activity
  â””â”€ Set Headers
  â†“ [HTTPS/TLS Encrypted]
Frontend Receives:
  â”œâ”€ Parse JSON
  â”œâ”€ Update State
  â””â”€ Render UI
  â†“
User Sees Result
```

---

## Summary

This architecture provides:
- âœ… **Scalable** - Modular backend routes
- âœ… **Secure** - JWT, HTTPS, validation
- âœ… **Maintainable** - Clear separation of concerns
- âœ… **Auditable** - Complete activity logging (including NEW sign-out events)
- âœ… **Performant** - Database indexes, pagination
- âœ… **User-friendly** - Responsive UI with Tailwind

---

**Last Updated:** November 26, 2025
**Status:** âœ… Complete with Sign-Out Logging
